# 템플릿 시스템 개선 제안

현재 템플릿 시스템의 개선 가능한 부분들을 정리했습니다.

## 🔍 현재 상태 분석

### ✅ 구현된 기능
- 드래그 앤 드롭으로 순서 변경
- 템플릿 편집 (이름, 설명, 트리거, 메시지)
- 활성화/비활성화 토글
- 로컬 스토리지 저장
- 변수 치환 (`{{variable}}`)
- 기본 5개 템플릿

### ⚠️ 개선 필요 사항
1. **저장소**: localStorage만 사용 (Supabase 연동 필요)
2. **미리보기**: 실제 변수 치환된 메시지 미리보기 없음
3. **템플릿 복사**: 템플릿 복제 기능 없음
4. **카테고리/태그**: 템플릿 분류 기능 없음
5. **통계**: 템플릿별 발송 통계 없음
6. **변수 자동완성**: 변수 입력 시 자동완성 없음
7. **검증**: 변수 누락 체크, 메시지 길이 체크 없음
8. **이메일 채널**: 카톡/SMS만 지원
9. **템플릿 라이브러리**: 공유 가능한 템플릿 없음
10. **버전 관리**: 템플릿 변경 이력 없음

## 🚀 개선 제안 (우선순위별)

### Phase 1: 핵심 기능 개선 ⭐⭐⭐

#### 1. 템플릿 미리보기 기능
**목적**: 실제 발송될 메시지를 미리 확인
**구현**:
- 템플릿 편집 시 "미리보기" 버튼 추가
- 샘플 환자 데이터로 변수 치환
- 카톡/SMS 실제 형식으로 표시

**예상 시간**: 2-3시간

#### 2. 템플릿 복사/복제 기능
**목적**: 기존 템플릿을 기반으로 새 템플릿 생성
**구현**:
- 템플릿 카드에 "복사" 버튼 추가
- 복사된 템플릿은 이름에 "(복사본)" 추가
- 즉시 편집 가능

**예상 시간**: 1시간

#### 3. 변수 자동완성
**목적**: 변수 입력 시 자동완성으로 오타 방지
**구현**:
- Textarea에 변수 자동완성 드롭다운
- `{{` 입력 시 사용 가능한 변수 목록 표시
- 변수 설명 툴팁

**예상 시간**: 2-3시간

#### 4. 템플릿 검증 시스템
**목적**: 발송 전 오류 방지
**구현**:
- 변수 누락 체크
- 메시지 길이 제한 (SMS: 90바이트, 카톡: 제한 없음)
- 필수 필드 검증
- 저장 전 경고 표시

**예상 시간**: 2시간

### Phase 2: 데이터베이스 통합 ⭐⭐⭐

#### 5. Supabase 템플릿 저장
**목적**: localStorage 대신 데이터베이스에 저장
**구현**:
- 템플릿 CRUD API 구현
- 템플릿 페이지에서 Supabase 연동
- localStorage → Supabase 마이그레이션

**예상 시간**: 3-4시간

#### 6. 템플릿 통계
**목적**: 각 템플릿의 성과 추적
**구현**:
- 템플릿별 발송 건수
- 성공률/실패율
- 템플릿 카드에 통계 표시
- 템플릿 상세 페이지

**예상 시간**: 3-4시간

### Phase 3: 고급 기능 ⭐⭐

#### 7. 템플릿 카테고리/태그
**목적**: 템플릿 분류 및 관리
**구현**:
- 카테고리: 예약, 후기, 프로모션, 리마인더 등
- 태그 시스템
- 필터링 기능
- 그룹별 정렬

**예상 시간**: 2-3시간

#### 8. 이메일 채널 추가
**목적**: 마케팅 채널 확장
**구현**:
- `Channel` 타입에 'email' 추가
- Resend API 연동
- 이메일 템플릿 에디터
- HTML 이메일 지원

**예상 시간**: 4-5시간

#### 9. 템플릿 라이브러리
**목적**: 공유 가능한 템플릿 제공
**구현**:
- 공개 템플릿 라이브러리
- 템플릿 가져오기 기능
- 템플릿 공유 기능 (선택사항)

**예상 시간**: 4-5시간

#### 10. A/B 테스트
**목적**: 템플릿 효과 측정
**구현**:
- 템플릿 변형 생성
- 자동 분할 테스트
- 성과 비교 대시보드
- 최적 템플릿 자동 선택

**예상 시간**: 6-8시간

### Phase 4: 고급 기능 ⭐

#### 11. 템플릿 버전 관리
**목적**: 변경 이력 추적
**구현**:
- 템플릿 변경 이력 저장
- 이전 버전으로 롤백
- 변경 사항 비교

**예상 시간**: 4-5시간

#### 12. 조건부 로직
**목적**: 동적 메시지 생성
**구현**:
- 조건부 변수 (`{{if}}`, `{{else}}`)
- 예: `{{if days_since_surgery > 7}}회복이 잘 되고 계신가요?{{else}}수술 후 첫날입니다.{{/if}}`

**예상 시간**: 6-8시간

#### 13. 템플릿 스케줄링
**목적**: 특정 시간에 발송
**구현**:
- 발송 시간 설정
- 시간대 선택
- 스케줄 관리

**예상 시간**: 3-4시간

## 💡 즉시 구현 가능한 개선사항

### 1. 템플릿 미리보기 (가장 유용)
```typescript
// 템플릿 편집 다이얼로그에 추가
<Button onClick={handlePreview}>
  미리보기
</Button>

// 샘플 데이터로 변수 치환
const samplePatient = {
  name: '홍길동',
  phone: '010-1234-5678',
  ...
};
const previewContent = replaceTemplateVariables(
  template.content,
  generateTemplateVariables({ patient: samplePatient })
);
```

### 2. 템플릿 복사 기능
```typescript
const handleDuplicate = (template: MarketingTemplate) => {
  const duplicated = {
    ...template,
    id: `template-${Date.now()}`,
    name: `${template.name} (복사본)`,
    createdAt: new Date(),
    updatedAt: new Date(),
  };
  // 템플릿 목록에 추가
};
```

### 3. 변수 자동완성
```typescript
// Textarea에 변수 자동완성 추가
const availableVariables = [
  { name: 'patient_name', description: '환자 이름' },
  { name: 'appointment_date', description: '예약 날짜' },
  ...
];

// {{ 입력 시 드롭다운 표시
```

### 4. 템플릿 검증
```typescript
function validateTemplate(template: MarketingTemplate): {
  isValid: boolean;
  errors: string[];
} {
  const errors: string[] = [];
  
  // 변수 누락 체크
  template.messages.forEach((msg, idx) => {
    const variables = extractVariables(msg.content);
    const missing = variables.filter(v => !isVariableAvailable(v));
    if (missing.length > 0) {
      errors.push(`메시지 ${idx + 1}: 사용 불가능한 변수 ${missing.join(', ')}`);
    }
  });
  
  // SMS 길이 체크
  template.messages.forEach((msg, idx) => {
    if (msg.channel === 'sms' && getByteLength(msg.content) > 90) {
      errors.push(`메시지 ${idx + 1}: SMS는 90바이트를 초과할 수 없습니다.`);
    }
  });
  
  return { isValid: errors.length === 0, errors };
}
```

## 📊 우선순위 매트릭스

| 기능 | 사용자 가치 | 구현 난이도 | 우선순위 |
|------|------------|------------|---------|
| 미리보기 | 높음 | 낮음 | ⭐⭐⭐ |
| 복사 기능 | 높음 | 낮음 | ⭐⭐⭐ |
| 변수 자동완성 | 중간 | 낮음 | ⭐⭐ |
| 검증 시스템 | 높음 | 중간 | ⭐⭐⭐ |
| Supabase 저장 | 높음 | 중간 | ⭐⭐⭐ |
| 템플릿 통계 | 중간 | 중간 | ⭐⭐ |
| 카테고리/태그 | 중간 | 낮음 | ⭐⭐ |
| 이메일 채널 | 높음 | 높음 | ⭐⭐ |
| A/B 테스트 | 낮음 | 높음 | ⭐ |

## 🎯 추천 구현 순서

1. **템플릿 미리보기** (가장 빠르고 유용)
2. **템플릿 복사 기능** (간단하고 유용)
3. **변수 자동완성** (UX 개선)
4. **템플릿 검증** (오류 방지)
5. **Supabase 저장** (데이터 영구 보존)
6. **템플릿 통계** (성과 추적)

어떤 기능부터 구현할까요?

