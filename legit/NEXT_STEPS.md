# 다음 단계 제안 (Next Steps)

현재 구현 상태를 분석하여 우선순위가 높은 기능들을 정리했습니다.

## ✅ 이미 구현된 기능

1. ✅ **웹훅 트리거** - 외부 시스템 연동
2. ✅ **조건부 분기 로직** - 템플릿에서 IF/ELSE 지원
3. ✅ **재시도 로직** - 실패한 메시지 자동 재시도
4. ✅ **기본 워크플로우 빌더** - 단계별 워크플로우 생성
5. ✅ **랜딩 페이지 개선** - 네비게이션, CTA, 푸터 추가

## 🎯 우선순위 높음 (즉시 구현 가능)

### 1. 워크플로우 실행 이력 UI ⭐⭐⭐
**목적**: 워크플로우 실행 추적 및 디버깅

**구현 내용**:
- 워크플로우별 실행 이력 페이지
- 실행 상태 표시 (성공/실패/진행중)
- 실행 시간 및 소요 시간
- 에러 메시지 및 로그 표시
- 필터링 (날짜, 상태별)
- 재실행 기능

**예상 시간**: 3-4시간

**파일 위치**:
- `app/[locale]/dashboard/workflows/[id]/executions/page.tsx`
- `app/api/workflows/[id]/executions/route.ts`

---

### 2. 웹훅 실행 이력 UI ⭐⭐⭐
**목적**: 웹훅 호출 추적 및 모니터링

**구현 내용**:
- 웹훅별 실행 이력 표시
- 요청/응답 페이로드 확인
- 실행 시간 및 상태 표시
- 에러 로그 확인
- 재실행 기능

**예상 시간**: 2-3시간

**파일 위치**:
- `app/[locale]/dashboard/webhooks/[id]/executions/page.tsx`
- 기존 `webhook_executions` 테이블 활용

---

### 3. 지연/대기 노드 (Delay Node) ⭐⭐⭐
**목적**: 특정 시간 후 메시지 발송

**구현 내용**:
- 워크플로우에 지연 단계 추가
- 지연 시간 설정 (분/시간/일)
- 특정 시간까지 대기
- 큐 시스템으로 스케줄링

**예상 시간**: 4-5시간

**구현 방법**:
- `lib/template-scheduler.ts` 확장
- Supabase Edge Functions 또는 cron job 사용
- 또는 Vercel Cron Jobs 활용

---

### 4. 워크플로우 템플릿 라이브러리 ⭐⭐ ✅
**목적**: 자주 사용하는 워크플로우를 템플릿으로 제공

**구현 내용**:
- 사전 정의된 워크플로우 템플릿 (9개)
  - 라식/라섹 집중 케어 (안과)
  - 백내장 수술 후 관리 (안과)
  - 코성형/눈성형 회복 관리 (성형외과)
  - 생일 할인 쿠폰, 후기 요청 등 (공통)
- 워크플로우 페이지에 "템플릿에서 시작" 버튼
- 템플릿 선택 및 미리보기 기능
- 템플릿에서 직접 워크플로우 생성 또는 편집 모드로 열기

**예상 시간**: 2-3시간

**파일 위치**:
- `lib/workflow-templates.ts` (기존 템플릿 활용)
- `components/workflow-template-selector.tsx` (신규)
- `app/[locale]/dashboard/workflows/page.tsx` (통합)

---

### 5. 워크플로우 테스트 모드 ⭐⭐ ✅
**목적**: 실제 발송 없이 워크플로우 테스트

**구현 내용**:
- 워크플로우 빌더에 "테스트 실행" 버튼 추가
- 클라이언트 사이드 시뮬레이션으로 워크플로우 검증
- 테스트 결과 다이얼로그 (실행 노드, 변수 치환, 타임라인 표시)
- 워크플로우 구조 및 로직 검증
- 실제 메시지 발송 없이 안전한 테스트 환경

**예상 시간**: 3-4시간

---

## 🚀 중간 우선순위 (고급 기능)

### 6. 시각적 워크플로우 빌더 (React Flow) ⭐⭐
**목적**: 드래그 앤 드롭으로 워크플로우 생성

**구현 내용**:
- React Flow 라이브러리 통합
- 노드 타입: 트리거, 액션, 조건, 지연
- 노드 간 연결
- 시각적 워크플로우 편집
- 워크플로우 저장 및 실행

**예상 시간**: 8-12시간

**필요 패키지**:
```bash
npm install reactflow
```

**파일 위치**:
- `components/visual-workflow-builder.tsx` (신규)

---

### 7. 필터링 노드 ⭐⭐
**목적**: 조건에 맞는 환자만 선택

**구현 내용**:
- 환자 필터링 조건 설정
  - 나이, 성별, 마지막 방문일
  - 수술 유형, 수술 날짜
  - 지역, 연락처 유형
- 동적 필터 조건
- 세그먼테이션

**예상 시간**: 3-4시간

---

### 8. 스케줄 트리거 (Cron) ⭐⭐
**목적**: 주기적으로 워크플로우 실행

**구현 내용**:
- Cron 표현식 지원
- 주기적 실행 설정
- Vercel Cron Jobs 통합
- 또는 Supabase Edge Functions

**예상 시간**: 4-5시간

**파일 위치**:
- `app/api/cron/workflows/route.ts` (신규)
- Vercel `vercel.json` 설정

---

### 9. 데이터 변환 노드 ⭐
**목적**: 데이터 포맷 변환

**구현 내용**:
- 날짜 포맷 변환
- 전화번호 포맷팅
- 텍스트 변환 (대소문자 등)
- 데이터 매핑

**예상 시간**: 4-5시간

---

## 💡 UI/UX 개선 사항

### 10. 대시보드 통계 개선 ⭐⭐
**목적**: 더 유용한 인사이트 제공

**구현 내용**:
- 워크플로우 실행 통계
- 메시지 발송 성공률
- 환자 응답률
- 실시간 알림

**예상 시간**: 3-4시간

---

### 11. 워크플로우 실행 모니터링 대시보드 ⭐⭐
**목적**: 실시간 워크플로우 상태 모니터링

**구현 내용**:
- 활성 워크플로우 목록
- 실행 중인 워크플로우 표시
- 실시간 상태 업데이트
- 알림 및 경고

**예상 시간**: 4-5시간

---

### 12. 환자 응답 관리 UI 개선 ⭐⭐
**목적**: 환자 응답을 더 쉽게 관리

**구현 내용**:
- 응답 목록 페이지
- 응답 상세 보기
- 응답 필터링 및 검색
- 응답에 대한 액션 (연락, 메모 등)

**예상 시간**: 3-4시간

---

## 🔧 기술적 개선 사항

### 13. 데이터베이스 최적화 ⭐
**목적**: 성능 향상

**구현 내용**:
- 인덱스 추가
- 쿼리 최적화
- 캐싱 전략

**예상 시간**: 2-3시간

---

### 14. 에러 핸들링 개선 ⭐
**목적**: 더 나은 에러 처리

**구현 내용**:
- 에러 타입 정의
- 에러 로깅 개선
- 사용자 친화적 에러 메시지

**예상 시간**: 2-3시간

---

### 15. 결제 시스템 도입 (PortOne) ⭐
**목적**: 예약금 결제 및 노쇼 방지

**구현 내용**:
- PortOne (구 아임포트) SDK 연동
- 예약금 결제 프로세스
- 결제 취소 및 환불 자동화
- 결제 내역 관리 UI

**예상 시간**: 8-12시간

**참고 문서**: `PAYMENT_INTEGRATION_PLAN.md`

### 16. 지도/위치 서비스 (Kakao Maps) ⭐
**목적**: 병원 위치 안내 및 길찾기 편의 제공

**구현 내용**:
- 웹페이지 내 Kakao Map 임베딩
- 예약 확정 메시지에 길찾기 링크 연동
- 병원 위치 마커 및 정보 표시

**예상 시간**: 4-6시간

**참고 문서**: `MAPS_INTEGRATION_PLAN.md`

---

## 📊 추천 구현 순서

### Phase 1 (즉시 구현 - 1주)
1. 워크플로우 실행 이력 UI
2. 웹훅 실행 이력 UI
3. 워크플로우 템플릿 라이브러리

### Phase 2 (단기 - 2주)
4. 지연/대기 노드
5. 워크플로우 테스트 모드
6. 대시보드 통계 개선

### Phase 3 (중기 - 1개월)
7. 시각적 워크플로우 빌더
8. 필터링 노드
9. 스케줄 트리거

### Phase 4 (장기 - 선택사항)
10. 데이터 변환 노드
11. 외부 API 통합
12. 고급 모니터링 기능
13. 결제 시스템 도입 (PortOne)
14. 지도/위치 서비스 (Kakao Maps)

---

## 🎯 가장 빠른 가치 창출

**추천: 워크플로우 실행 이력 UI부터 시작**

이유:
- 이미 데이터베이스에 `webhook_executions` 테이블이 있음
- 사용자가 워크플로우가 제대로 실행되는지 확인할 수 있음
- 디버깅에 필수적
- 구현이 비교적 간단함

**다음으로: 웹훅 실행 이력 UI**
- 웹훅 사용자가 많을 것으로 예상
- 외부 연동 디버깅에 필수
- 빠르게 구현 가능

---

## 💻 빠른 시작 가이드

### 워크플로우 실행 이력 UI 구현 예시

```typescript
// app/[locale]/dashboard/workflows/[id]/executions/page.tsx
"use client";

import { useState, useEffect } from "react";
import { Card } from "@/components/ui/card";
import { Badge } from "@/components/ui/badge";
import { CheckCircle2, XCircle, Clock, Loader2 } from "lucide-react";

interface Execution {
  id: string;
  status: 'pending' | 'running' | 'completed' | 'failed';
  created_at: string;
  completed_at?: string;
  execution_time_ms?: number;
  error_message?: string;
}

export default function WorkflowExecutionsPage({ params }: { params: { id: string } }) {
  const [executions, setExecutions] = useState<Execution[]>([]);
  
  // API 호출로 실행 이력 조회
  // ...
  
  return (
    <div>
      {/* 실행 이력 목록 */}
    </div>
  );
}
```

---

## 📝 참고사항

- 모든 기능은 기존 아키텍처와 호환되어야 함
- UI는 기존 디자인 시스템(shadcn/ui) 사용
- TypeScript 타입 안정성 유지
- 에러 핸들링 및 사용자 피드백 필수

---

**마지막 업데이트**: 2025-01-XX
**다음 리뷰**: Phase 1 완료 후

